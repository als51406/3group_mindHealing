# ë„¤íŠ¸ì›Œí¬ ë§¤ì¹­ ì‹œìŠ¤í…œ ì„¤ì • ê°€ì´ë“œ

## âœ… ì™„ë£Œëœ ìˆ˜ì • ì‚¬í•­

### 1. ì„œë²„ ì„¤ì • (server/index.ts)
- âœ… `httpServer.listen(PORT, '0.0.0.0')` â†’ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
- âœ… Socket.IO CORS ì„¤ì •: `origin: "*"`, `credentials: true`
- âœ… `transports: ['websocket', 'polling']` ì§€ì›
- âœ… Express CORS: ëª¨ë“  origin í—ˆìš©, credentials í™œì„±í™”

### 2. í´ë¼ì´ì–¸íŠ¸ ì„¤ì • (Online.tsx)
- âœ… ìë™ ì„œë²„ ì£¼ì†Œ ê°ì§€:
  - `localhost` â†’ `http://localhost:7780`
  - `192.168.4.8` â†’ `http://192.168.4.8:7780`
- âœ… Socket.IO ì—°ê²° ì˜µì…˜:
  - `withCredentials: true` (ì¿ í‚¤ ì „ì†¡)
  - `transports: ['websocket', 'polling']`
  - ìë™ ì¬ì—°ê²° í™œì„±í™”

### 3. Vite ì„¤ì • (vite.config.ts)
- âœ… `host: '0.0.0.0'` â†’ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ í—ˆìš©
- âœ… `/api` í”„ë¡ì‹œ: `http://localhost:7780`
- âœ… Socket.IOëŠ” **ì§ì ‘ ì—°ê²°** (í”„ë¡ì‹œ ë¯¸ì‚¬ìš©)

### 4. í™˜ê²½ë³€ìˆ˜ (.env)
- âœ… `.env.development`: ìë™ ê°ì§€ ëª¨ë“œ
- âœ… `.env.production`: ìë™ ê°ì§€ ëª¨ë“œ

---

## ğŸš€ ë„¤íŠ¸ì›Œí¬ ì ‘ì† ë°©ë²•

### ì„œë²„ ê¸°ê¸° (192.168.4.8)

#### 1ï¸âƒ£ ë°±ì—”ë“œ ì„œë²„ ì‹œì‘
```bash
npx tsx server/index.ts > server.log 2>&1 &
```

**í™•ì¸:**
```bash
# ì„œë²„ ë¡œê·¸
tail -f server.log

# í¬íŠ¸ í™•ì¸ (0.0.0.0:7780 ë˜ëŠ” *:7780ì´ì–´ì•¼ í•¨)
lsof -i :7780
```

#### 2ï¸âƒ£ Vite ê°œë°œ ì„œë²„ ì‹œì‘
```bash
npm run dev
```

**í™•ì¸:**
```
VITE v5.4.1  ready in XXX ms

âœ  Local:   http://localhost:5173/
âœ  Network: http://192.168.4.8:5173/
```

---

### í´ë¼ì´ì–¸íŠ¸ ê¸°ê¸° (ë‹¤ë¥¸ ê¸°ê¸°)

#### ì ‘ì† ì£¼ì†Œ
```
http://192.168.4.8:5173
```

#### ìë™ ì—°ê²° ê³¼ì •
1. **í˜ì´ì§€ ë¡œë“œ**: `http://192.168.4.8:5173`
2. **API ìš”ì²­**: `http://192.168.4.8:5173/api/*` â†’ Vite í”„ë¡ì‹œ â†’ `http://localhost:7780/api/*`
3. **Socket.IO ì—°ê²°**: ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ `http://192.168.4.8:7780`ìœ¼ë¡œ ì—°ê²°

#### ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ í™•ì¸
```javascript
// ì½˜ì†”ì—ì„œ í™•ì¸í•  ë¡œê·¸
ğŸŒ Socket.IO ì„œë²„ ì—°ê²° ì£¼ì†Œ: http://192.168.4.8:7780
ğŸ“ í˜„ì¬ í˜ì´ì§€ ì£¼ì†Œ: http://192.168.4.8:5173/online
âœ… ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤: [socket-id], ì´ë©”ì¼: [user-email]
```

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. ì„œë²„ ì—°ê²° ì‹¤íŒ¨
```bash
# 1. ì„œë²„ê°€ 0.0.0.0ì—ì„œ ë¦¬ìŠ¤ë‹ ì¤‘ì¸ì§€ í™•ì¸
lsof -i :7780
# ì¶œë ¥: *:7780 (LISTEN) â† ì´ë ‡ê²Œ ë‚˜ì™€ì•¼ í•¨

# 2. ë°©í™”ë²½ í™•ì¸
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate

# 3. í¬íŠ¸ ë°©í™”ë²½ ê·œì¹™ (í•„ìš”ì‹œ)
# macOSëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ ë°©í™”ë²½ ì‚¬ìš©
```

### 2. Socket.IO ì—°ê²° ì—ëŸ¬
```javascript
// ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸
âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨: [ì—ëŸ¬ ë©”ì‹œì§€]

// ì›ì¸:
// - ì„œë²„ IPê°€ ì˜ëª»ë¨
// - í¬íŠ¸ê°€ ì—´ë ¤ìˆì§€ ì•ŠìŒ
// - CORS ì„¤ì • ë¬¸ì œ
```

**í•´ê²°:**
```bash
# ì„œë²„ ë¡œê·¸ í™•ì¸
tail -50 server.log

# í´ë¼ì´ì–¸íŠ¸ IPì—ì„œ ì„œë²„ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
curl http://192.168.4.8:7780/api/health
```

### 3. API ìš”ì²­ ì‹¤íŒ¨ (401 Unauthorized)
```javascript
// ì¿ í‚¤ê°€ ì „ë‹¬ë˜ì§€ ì•ŠëŠ” ê²½ìš°
// withCredentials: true í™•ì¸
```

**í•´ê²°:**
- `Online.tsx`ì—ì„œ `withCredentials: true` ì„¤ì • í™•ì¸
- ì„œë²„ CORS ì„¤ì •ì—ì„œ `credentials: true` í™•ì¸

### 4. ê°™ì€ ë„¤íŠ¸ì›Œí¬ì¸ë° ì—°ê²° ì•ˆ ë¨
```bash
# 1. ê°™ì€ ì„œë¸Œë„·ì¸ì§€ í™•ì¸
# ì„œë²„ ê¸°ê¸°
ipconfig getifaddr en0
# â†’ 192.168.4.8

# í´ë¼ì´ì–¸íŠ¸ ê¸°ê¸°
ipconfig getifaddr en0
# â†’ 192.168.4.XXX (ê°™ì€ ëŒ€ì—­ì´ì–´ì•¼ í•¨)

# 2. ping í…ŒìŠ¤íŠ¸
ping 192.168.4.8

# 3. í¬íŠ¸ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
nc -zv 192.168.4.8 7780
```

---

## ğŸ“Š ë™ì‘ ì›ë¦¬

### ì•„í‚¤í…ì²˜
```
[í´ë¼ì´ì–¸íŠ¸ ê¸°ê¸°] 192.168.4.100
    â†“ HTTP
[Vite Dev Server] 192.168.4.8:5173
    â†“ Proxy (/api)
[Express Server] 192.168.4.8:7780
    â†• WebSocket (ì§ì ‘ ì—°ê²°, í”„ë¡ì‹œ X)
[Socket.IO Server] 192.168.4.8:7780
```

### ì£¼ì†Œ ìë™ ê°ì§€ ë¡œì§
```typescript
// Online.tsx
const currentHost = window.location.hostname;
// localhost â†’ http://localhost:7780
// 192.168.4.8 â†’ http://192.168.4.8:7780
```

### ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦
```typescript
// 1. ë¡œê·¸ì¸ ì‹œ ì¿ í‚¤ ë°œê¸‰ (Express)
res.cookie('token', signToken(...), { httpOnly: true });

// 2. Socket.IO ì—°ê²° ì‹œ ì¿ í‚¤ ì „ì†¡
io(serverLink, { withCredentials: true });

// 3. ì„œë²„ì—ì„œ ì¿ í‚¤ íŒŒì‹± (JWT)
const token = socket.handshake.headers.cookie;
const decoded = jwt.verify(token, JWT_SECRET);
```

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì„œë²„ ì¸¡ (192.168.4.8)
- [ ] `npx tsx server/index.ts` ì‹¤í–‰ ì¤‘
- [ ] `lsof -i :7780` â†’ `*:7780 (LISTEN)` í™•ì¸
- [ ] `npm run dev` ì‹¤í–‰ ì¤‘
- [ ] ë°©í™”ë²½ ë¹„í™œì„±í™” ë˜ëŠ” 7780 í¬íŠ¸ í—ˆìš©

### í´ë¼ì´ì–¸íŠ¸ ì¸¡ (ë‹¤ë¥¸ ê¸°ê¸°)
- [ ] `http://192.168.4.8:5173` ì ‘ì†
- [ ] ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ `ğŸŒ Socket.IO ì„œë²„ ì—°ê²° ì£¼ì†Œ` ë¡œê·¸ í™•ì¸
- [ ] `âœ… ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤` ë¡œê·¸ í™•ì¸
- [ ] ë§¤ì¹­ ì‹œë„ í›„ ìƒëŒ€ë°© í”„ë¡œí•„ ì •ë³´ í‘œì‹œ í™•ì¸

---

## ğŸ“ ì¶”ê°€ ê°œì„  ì‚¬í•­ (ì„ íƒ)

### HTTPS ì‚¬ìš© (í”„ë¡œë•ì…˜)
```javascript
// Online.tsx
const protocol = window.location.protocol; // http: or https:
const serverLink = `${protocol}//${currentHost}:7780`;
```

### í™˜ê²½ë³€ìˆ˜ë¡œ ê³ ì • ì£¼ì†Œ ì‚¬ìš©
```bash
# .env.local
VITE_SOCKET_SERVER_URL=http://192.168.4.8:7780
```

### PM2ë¡œ ì„œë²„ ê´€ë¦¬
```bash
# ì„¤ì¹˜
npm install -g pm2

# ì‹œì‘
pm2 start "npx tsx server/index.ts" --name "api-server"

# ëª¨ë‹ˆí„°ë§
pm2 monit

# ë¡œê·¸
pm2 logs api-server
```

---

## ğŸ‰ ì™„ë£Œ!

ì´ì œ **ê°™ì€ ë„¤íŠ¸ì›Œí¬ì˜ ë‹¤ë¥¸ ê¸°ê¸°**ì—ì„œ `http://192.168.4.8:5173`ìœ¼ë¡œ ì ‘ì†í•˜ì—¬ ë§¤ì¹­ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
